<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USER</title>
    <link rel="stylesheet" href="../static/css/user_style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/style2.css">
    <link rel="stylesheet" href="../static/css/ChonRap_style.css">
</head>

<body class="main">
    <div class="hd_chonrap">
        <div class="hd_chonrap_top">
            <div class="container">
                <div class="hd_chonrap_top_components">
                    <a class="main_logo_link" href="{{ url_for('home') }}"> 
                        <img src="../static/assets/logo.jpg">
                    </a>
                    <div class="hd_left_action">
                        <a button class="btn book_btn" href="{{ url_for('home') }}">                 
                            <img src="../static/assets/ic-ticket.svg">
                            <span class="text" style="font-size: 0.7em;">Đặt vé ngay</span>                           
                        </a>
                    </div>
                    <div class="hd_right_action">
                        <!--Search-->
                        <div class="hd_search">
                            <div class="search_icon">
                                <img src="../static/assets/icon-search.svg">
                            </div>
                            <div class="search_panel" data-name="panel_search">
                                <div class="search_panel_form">
                                    <div>
                                        <div class="search_panel_form_content">
                                            <input class="search_content" type="text" id="searchInput"
                                                placeholder="Nhập tên phim">
                                            <a href="#"> 
                                                <button class="search_btn" type="submit" onclick="searchMovies()">
                                                    <img src="../static/assets/ic-header-search.svg">
                                                </button>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--Register/Login-->
                        <div class="hd_register_login">
                            <div class="hd_register_login_content">
                                <div class="hd_register_login_list">
                                    {% if session.email %}
                                    <div class="hd_register_login_ava">
                                        <a href="{{url_for('user')}}">
                                            <img src="../static/assets/ic-header-auth.svg">
                                        </a>
                                    </div>
                                    <p>{{ session.email }} <br> <a class="logout" href="{{ url_for('logout') }}">Đăng
                                            xuất</a>
                                    </p>
                                    {% else %}
                                    <a class="link" href="#">
                                        <i class="login"></i>Đăng nhập
                                    </a>
                                    <span class="separate">/</span>
                                    <a class="link" href="#">
                                        <i class="register"></i>Đăng kí
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <!--Language-->
                        <div class="hd_language">
                            <div class="hd_language_action">
                                <div class="hd_language_popup">
                                    <div class="hd_language_option">
                                        <span class="image">
                                            <img style="width: 100%;" src="../static/assets/footer-vietnam.svg">
                                        </span>
                                        <span class="text">
                                            VN
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Nav bars-->
                    <div class="nav_bars-btn">  
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>
                    </div>
                 
                    <div class="nav_mobile-close">                            
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/></svg>
                    </div>
                </div>
            </div>
        </div>
        <div class="hd_chonrap_mid">
            <div class="container">
                <div class="hd_chonrap_mid_components">
                    <a class="local" href="{{ url_for('chonrap') }}"> 
                        <span class="text_chonrap">Chọn rạp</span>
                    </a>
                    <div class="other">
                        <a class="link" href="{{ url_for('khuyenmai') }}">Khuyến mãi</a>
                        <a class="link" href="{{ url_for('thuesukien') }}">Thuê sự kiện</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="nav_mobile">
        <ul class="nav_mobile-list">
            <li class="nav_mobile-link"><a class="link" href="#">Người dùng<b>▼</b></a>
                <ul>
                    <li class="nav_mobile-link-components">
                        <a class="link" href="{{url_for('user')}}" style="text-decoration: none; margin-left: 0.5em;">
                            {% if session.email %}
                            <p>{{ session.email }}</p>
                            {% endif %}
                        </a>
                    </li>
                    <li class="nav_mobile-link-components">
                        <a class="link" href="{{ url_for('logout') }}" style="text-decoration: none; margin-left: 0.3em;">Đăng xuất</a>
                    </li>
                </ul>
            </li>
            <li class="nav_mobile-link">
                <a button class="link" href="{{ url_for('home') }}">                
                    Đặt vé ngay                         
                </a>
            </li>
            <li class="nav_mobile-link">
                <a class="link" href="{{ url_for('chonrap') }}">Chọn rạp</a>
            </li>
            <li class="nav_mobile-link">
                <a class="link" href="{{ url_for('khuyenmai') }}">Khuyến mãi</a>
            </li>
            <li class="nav_mobile-link">
                <a class="link" href="{{ url_for('thuesukien') }}">Thuê sự kiện</a>
            </li>
        </ul>
    </div>
    
    <div class="main-content">
        <div class="container light-style flex-grow-1 container-p-y">
            <h4 class="font-weight-bold py-3 mb-4">
                Xin chào {{ auth_email }}!
            </h4>
            <div class="card overflow-hidden">
                <div class="row no-gutters row-bordered row-border-light">
                    <div class="col-md-3 pt-0">
                        <div class="list-group list-group-flush account-settings-links">
                            <a class="list-group-item list-group-item-action active" data-toggle="list"
                                href="#my-tickets">Vé đã mua</a>
                            <!-- <a class="list-group-item list-group-item-action" data-toggle="list"
                                href="#account-change-password">Change password</a>
                            <a class="list-group-item list-group-item-action" data-toggle="list"
                                href="#account-info">Info</a>
                            <a class="list-group-item list-group-item-action" data-toggle="list"
                                href="#account-social-links">Social links</a>
                            <a class="list-group-item list-group-item-action" data-toggle="list"
                                href="#account-connections">Connections</a>
                            <a class="list-group-item list-group-item-action" data-toggle="list"
                                href="#account-notifications">Notifications</a> -->
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="tab-content">
                            <div class="tab-pane fade active show" id="my-tickets">
                                <div id="tickets-container"></div>
                                <script>
                                    // Hàm gọi API để lấy dữ liệu vé
                                    function loadTickets() {
                                        fetch('/api/get_tickets')
                                            .then(response => response.json())
                                            .then(data => {
                                                const ticketsContainer = document.getElementById('tickets-container');
                                                ticketsContainer.innerHTML = ''; // Xóa nội dung cũ
                                                data.forEach(ticket => {
                                                    const card = document.createElement('div');
                                                    card.className = 'card';

                                                    const cardBody = document.createElement('div');
                                                    cardBody.className = 'card-body';

                                                    const cardTitle = document.createElement('h5');
                                                    cardTitle.className = 'card-title';
                                                    cardTitle.textContent = `Mã Vé: ${ticket.id_ve}`;

                                                    const cardText = document.createElement('p');
                                                    cardText.className = 'card-text';
                                                    cardText.innerHTML = `
                                                        Tên Phim: ${ticket.ten_phim}<br>
                                                        ID Phim: ${ticket.id_phim}<br>
                                                        Ngày Chiếu: ${ticket.ngay_chieu}<br>
                                                        Giờ Bắt Đầu: ${ticket.gio_bat_dau}<br>
                                                        Thông tin ghế: Hàng ${ticket.hang}, Cột ${ticket.cot}<br>
                                                        Suất chiếu: ${ticket.id_cachieu}<br>
                                                        Loại ghế: ${ticket.id_giave === 1 ? 'Ghế đơn' : 'Ghế đôi'}<br>
                                                        Giá tiền: ${ticket.thanh_tien}
                                                    `;

                                                    const cancelButton = document.createElement('a');
                                                    cancelButton.href = '#';
                                                    cancelButton.className = 'btn btn-danger';
                                                    cancelButton.textContent = 'Huỷ vé';
                                                    cancelButton.onclick = () => delete_ticket(ticket.id_ve);

                                                    cardBody.appendChild(cardTitle);
                                                    cardBody.appendChild(cardText);
                                                    cardBody.appendChild(cancelButton);
                                                    card.appendChild(cardBody);
                                                    ticketsContainer.appendChild(card);
                                                });
                                            })
                                            .catch(error => console.error('Error:', error));
                                    }

                                    // Hàm huỷ vé
                                    function delete_ticket(ticketId) {
                                        if (confirm('Bạn có chắc muốn hủy vé này không?')) {
                                            fetch('/api/delete_ticket', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({ id_ve: ticketId }),
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    if (data.success) {
                                                        alert('Đã huỷ vé thành công.');
                                                        loadTickets(); // Tải lại danh sách vé sau khi hủy
                                                    } else {
                                                        alert('Có lỗi xảy ra, vui lòng thử lại.');
                                                    }
                                                })
                                                .catch(error => console.error('Error:', error));
                                        }
                                    }

                                    // Gọi hàm loadTickets khi tải trang
                                    loadTickets();
                                </script>

                            </div>
                            <div class="tab-pane fade" id="account-change-password">
                                <div class="card-body pb-2">
                                    <div class="form-group">
                                        <label class="form-label">Current password</label>
                                        <input type="password" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New password</label>
                                        <input type="password" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Repeat new password</label>
                                        <input type="password" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="account-info">
                                <div class="card-body pb-2">
                                    <div class="form-group">
                                        <label class="form-label">Bio</label>
                                        <textarea class="form-control"
                                            rows="5">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris nunc arcu, dignissim sit amet sollicitudin iaculis, vehicula id urna. Sed luctus urna nunc. Donec fermentum, magna sit amet rutrum pretium, turpis dolor molestie diam, ut lacinia diam risus eleifend sapien. Curabitur ac nibh nulla. Maecenas nec augue placerat, viverra tellus non, pulvinar risus.</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Birthday</label>
                                        <input type="text" class="form-control" value="May 3, 1995">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Country</label>
                                        <select class="custom-select">
                                            <option>USA</option>
                                            <option selected>Canada</option>
                                            <option>UK</option>
                                            <option>Germany</option>
                                            <option>France</option>
                                        </select>
                                    </div>
                                </div>
                                <hr class="border-light m-0">
                                <div class="card-body pb-2">
                                    <h6 class="mb-4">Contacts</h6>
                                    <div class="form-group">
                                        <label class="form-label">Phone</label>
                                        <input type="text" class="form-control" value="+0 (123) 456 7891">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Website</label>
                                        <input type="text" class="form-control" value>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="account-social-links">
                                <div class="card-body pb-2">
                                    <div class="form-group">
                                        <label class="form-label">Twitter</label>
                                        <input type="text" class="form-control" value="https://twitter.com/user">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Facebook</label>
                                        <input type="text" class="form-control" value="https://www.facebook.com/user">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Google+</label>
                                        <input type="text" class="form-control" value>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">LinkedIn</label>
                                        <input type="text" class="form-control" value>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Instagram</label>
                                        <input type="text" class="form-control" value="https://www.instagram.com/user">
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="account-connections">
                                <div class="card-body">
                                    <button type="button" class="btn btn-twitter">Connect to
                                        <strong>Twitter</strong></button>
                                </div>
                                <hr class="border-light m-0">
                                <div class="card-body">
                                    <h5 class="mb-2">
                                        <a href="javascript:void(0)" class="float-right text-muted text-tiny"><i
                                                class="ion ion-md-close"></i> Remove</a>
                                        <i class="ion ion-logo-google text-google"></i>
                                        You are connected to Google:
                                    </h5>
                                    <a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                        data-cfemail="f9979498818e9c9595b994989095d79a9694">[email&#160;protected]</a>
                                </div>
                                <hr class="border-light m-0">
                                <div class="card-body">
                                    <button type="button" class="btn btn-facebook">Connect to
                                        <strong>Facebook</strong></button>
                                </div>
                                <hr class="border-light m-0">
                                <div class="card-body">
                                    <button type="button" class="btn btn-instagram">Connect to
                                        <strong>Instagram</strong></button>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="account-notifications">
                                <div class="card-body pb-2">
                                    <h6 class="mb-4">Activity</h6>
                                    <div class="form-group">
                                        <label class="switcher">
                                            <input type="checkbox" class="switcher-input" checked>
                                            <span class="switcher-indicator">
                                                <span class="switcher-yes"></span>
                                                <span class="switcher-no"></span>
                                            </span>
                                            <span class="switcher-label">Email me when someone comments on my
                                                article</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="switcher">
                                            <input type="checkbox" class="switcher-input" checked>
                                            <span class="switcher-indicator">
                                                <span class="switcher-yes"></span>
                                                <span class="switcher-no"></span>
                                            </span>
                                            <span class="switcher-label">Email me when someone answers on my forum
                                                thread</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="switcher">
                                            <input type="checkbox" class="switcher-input">
                                            <span class="switcher-indicator">
                                                <span class="switcher-yes"></span>
                                                <span class="switcher-no"></span>
                                            </span>
                                            <span class="switcher-label">Email me when someone follows me</span>
                                        </label>
                                    </div>
                                </div>
                                <hr class="border-light m-0">
                                <div class="card-body pb-2">
                                    <h6 class="mb-4">Application</h6>
                                    <div class="form-group">
                                        <label class="switcher">
                                            <input type="checkbox" class="switcher-input" checked>
                                            <span class="switcher-indicator">
                                                <span class="switcher-yes"></span>
                                                <span class="switcher-no"></span>
                                            </span>
                                            <span class="switcher-label">News and announcements</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="switcher">
                                            <input type="checkbox" class="switcher-input">
                                            <span class="switcher-indicator">
                                                <span class="switcher-yes"></span>
                                                <span class="switcher-no"></span>
                                            </span>
                                            <span class="switcher-label">Weekly product updates</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="switcher">
                                            <input type="checkbox" class="switcher-input" checked>
                                            <span class="switcher-indicator">
                                                <span class="switcher-yes"></span>
                                                <span class="switcher-no"></span>
                                            </span>
                                            <span class="switcher-label">Weekly blog digest</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript"></script>
    <script src="../static/js/responsive_for_header-tablet.js"></script>
    <script src="../static/js/responsive_for_header-mobile.js"></script>
</body>

</html>